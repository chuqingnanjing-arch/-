<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>AI æ™ºèƒ½æ‹ç…§ç¥å™¨</title>
    <!-- å¼•å…¥ AI åº“ -->
    <script src="https://unpkg.com/ml5@latest/dist/ml5.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { background: #000; margin: 0; overflow: hidden; color: white; }
        #camera-container { position: relative; width: 100vw; height: 100vh; }
        video { width: 100%; height: 100%; object-fit: cover; }
        
        /* æ ¸å¿ƒå‚è€ƒå›¾ï¼šé«˜ç²¾ç»†åº¦ PNG */
        #pose-overlay {
            position: absolute;
            top: 50%; left: 50%;
            transform: translate(-50%, -50%);
            width: 85%; /* è°ƒå¤§æ¯”ä¾‹ï¼Œç¬¦åˆä½ æˆªå›¾çš„æ•ˆæœ */
            opacity: 0.8;
            pointer-events: none;
            transition: all 0.5s ease; /* åˆ‡æ¢å§¿åŠ¿æ—¶çš„æ·¡å…¥æ·¡å‡ºæ•ˆæœ */
        }

        /* AI è¯†åˆ«çŠ¶æ€æ ‡ç­¾ */
        .ai-status {
            position: absolute;
            top: 50px; left: 20px;
            background: rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(10px);
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 12px;
            display: flex; align-items: center; gap: 8px;
        }
        .ai-dot { width: 8px; height: 8px; background: #00ff00; border-radius: 50%; box-shadow: 0 0 10px #00ff00; }

        .controls { position: absolute; bottom: 50px; width: 100%; display: flex; justify-content: space-around; align-items: center; }
        .shutter-btn { width: 75px; height: 75px; background: white; border-radius: 50%; border: 5px solid rgba(255,255,255,0.3); }
    </style>
</head>
<body>

<div id="camera-container">
    <!-- AI è¯†åˆ«åé¦ˆ -->
    <div class="ai-status">
        <div class="ai-dot"></div>
        <span>AI æ­£åœ¨è¯†åˆ«ç¯å¢ƒ: <b id="scene-label">åˆ†æä¸­...</b></span>
    </div>

    <video id="video" autoplay playsinline></video>
    
    <!-- è¿™é‡Œçš„ src ä¼šæ ¹æ® AI è¯†åˆ«ç»“æœåŠ¨æ€æ”¹å˜ -->
    <img id="pose-overlay" src="" alt="">

    <div class="controls">
        <button onclick="toggleCamera()" class="bg-black/40 p-3 rounded-full">ğŸ”„</button>
        <button class="shutter-btn" onclick="takePhoto()"></button>
        <button onclick="manualNext()" class="bg-black/40 p-3 rounded-full">ä¸‹ä¸€å¼ </button>
    </div>
</div>

<canvas id="canvas" style="display:none;"></canvas>

<script>
    const video = document.getElementById('video');
    const label = document.getElementById('scene-label');
    const overlay = document.getElementById('pose-overlay');
    let classifier;
    let currentFacingMode = "environment";

    // 1. åˆå§‹åŒ– AI æ¨¡å‹ (ä½¿ç”¨ MobileNet è¯†åˆ«åœºæ™¯)
    async function setupAI() {
        classifier = ml5.imageClassifier('MobileNet', video, modelReady);
    }

    function modelReady() {
        console.log('AI æ¨¡å‹åŠ è½½æˆåŠŸï¼');
        classifyImage();
    }

    // 2. æ ¸å¿ƒ AI é€»è¾‘ï¼šæ¯ç§’è¯†åˆ«ä¸€æ¬¡åœºæ™¯
    function classifyImage() {
        classifier.classify((err, results) => {
            if (results) {
                const detected = results[0].label.toLowerCase();
                updatePoseByAI(detected);
            }
            setTimeout(classifyImage, 2000); // æ¯2ç§’åˆ†æä¸€æ¬¡ï¼Œé¿å…æ‰‹æœºå‘çƒ«
        });
    }

    // 3. AI å†³ç­–æ ‘ï¼šè¯†åˆ«åˆ°ä»€ä¹ˆï¼Œå°±æ¨èä»€ä¹ˆ
    function updatePoseByAI(info) {
        label.innerText = info.split(',')[0]; // æ˜¾ç¤ºè¯†åˆ«åˆ°çš„ç‰©ä½“å

        // å¦‚æœè¯†åˆ«åˆ°â€œæ°´/æµ·/æµ·æ»©â€ï¼Œæ¨èæµ·è¾¹å§¿åŠ¿
        if (info.includes('water') || info.includes('beach') || info.includes('sea')) {
            overlay.src = "beach.png"; 
        } 
        // å¦‚æœè¯†åˆ«åˆ°â€œè¡—é“/æ±½è½¦/å»ºç­‘â€ï¼Œæ¨èè¡—æ‹
        else if (info.includes('street') || info.includes('building') || info.includes('car')) {
            overlay.src = "street.png";
        }
        // å¦‚æœè¯†åˆ«åˆ°â€œæ¡Œå­/æ¯å­/é¤å…â€ï¼Œæ¨èå’–å•¡é¦†å§¿åŠ¿
        else if (info.includes('coffee') || info.includes('table') || info.includes('cup')) {
            overlay.src = "cafe.png";
        }
        // é»˜è®¤å§¿åŠ¿
        else {
            if(!overlay.src) overlay.src = "street.png"; 
        }
    }

    // 4. æ‘„åƒå¤´æ§åˆ¶
    async function initCamera() {
        const stream = await navigator.mediaDevices.getUserMedia({ 
            video: { facingMode: currentFacingMode }, audio: false 
        });
        video.srcObject = stream;
        setupAI();
    }

    function toggleCamera() {
        currentFacingMode = currentFacingMode === "environment" ? "user" : "environment";
        initCamera();
    }

    function takePhoto() {
        const canvas = document.getElementById('canvas');
        canvas.width = video.videoWidth;
        canvas.height = video.videoHeight;
        const ctx = canvas.getContext('2d');
        if (currentFacingMode === "user") {
            ctx.translate(canvas.width, 0);
            ctx.scale(-1, 1);
        }
        ctx.drawImage(video, 0, 0);
        
        // å¼¹å‡ºä¿å­˜æç¤º
        const data = canvas.toDataURL('image/jpeg');
        const win = window.open();
        win.document.write('<img src="' + data + '" style="width:100%"><p>é•¿æŒ‰ä¸Šæ–¹ç…§ç‰‡ä¿å­˜</p>');
    }

    window.onload = initCamera;
</script>
</body>
</html>