<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ç”·å‹ç›¸æœº Pro Max</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { background: #000; margin: 0; overflow: hidden; font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto; }
        #camera-container { position: relative; width: 100vw; height: 100vh; }
        video { width: 100%; height: 100%; object-fit: cover; }
        
        /* å§¿åŠ¿è½®å»“å‚è€ƒå±‚ - ä»…åœ¨å–æ™¯æ—¶å¯è§ */
        #pose-overlay {
            position: absolute;
            top: 50%; left: 50%;
            transform: translate(-50%, -50%);
            width: 80%; 
            opacity: 0.6;
            pointer-events: none;
            filter: drop-shadow(0 0 8px rgba(255,255,255,0.5));
        }

        /* é¡¶éƒ¨å¯¼èˆªï¼šåœºæ™¯é€‰æ‹© */
        .scene-bar {
            position: absolute;
            top: 40px; left: 0; width: 100%;
            display: flex; justify-content: center; gap: 15px;
            z-index: 10;
        }
        .scene-btn { color: rgba(255,255,255,0.6); font-size: 14px; padding: 5px 10px; border-radius: 20px; }
        .scene-btn.active { color: #fff; background: rgba(255,255,255,0.2); font-weight: bold; }

        /* åº•éƒ¨æ§åˆ¶åŒº */
        .controls { 
            position: absolute; bottom: 50px; width: 100%; 
            display: flex; justify-content: space-around; align-items: center;
        }
        .shutter-btn { 
            width: 70px; height: 70px; background: white; border-radius: 50%; 
            border: 5px solid rgba(255,255,255,0.3);
        }
        .icon-btn { color: white; background: rgba(0,0,0,0.4); padding: 10px; border-radius: 50%; width: 45px; height: 45px; display: flex; align-items: center; justify-content: center;}

        /* ç»“æœé¢„è§ˆ */
        #result-container { 
            display: none; position: fixed; inset: 0; background: #000; z-index: 100; 
            flex-direction: column; align-items: center; justify-content: center; 
        }
        #result-img { max-width: 100%; max-height: 80%; }
    </style>
</head>
<body>

<div id="camera-container">
    <div class="scene-bar">
        <div class="scene-btn active" onclick="switchScene('street', this)">è¡—æ‹</div>
        <div class="scene-btn" onclick="switchScene('cafe', this)">å’–å•¡é¦†</div>
        <div class="scene-btn" onclick="switchScene('beach', this)">æµ·è¾¹</div>
        <div class="scene-btn" onclick="switchScene('park', this)">å…¬å›­</div>
    </div>

    <video id="video" autoplay playsinline></video>
    
    <!-- åŠ¨æ€è½®å»“å›¾ -->
    <img id="pose-overlay" src="" alt="å§¿åŠ¿å‚è€ƒ">

    <div class="controls">
        <!-- åˆ‡æ¢é•œå¤´ -->
        <button class="icon-btn" onclick="toggleCamera()">ğŸ”„</button>
        <!-- æ‹ç…§ -->
        <button class="shutter-btn" onclick="takePhoto()"></button>
        <!-- åˆ‡æ¢å§¿åŠ¿ -->
        <button class="icon-btn" onclick="nextPose()">â–¶ï¸</button>
    </div>
</div>

<div id="result-container">
    <p class="text-white mb-4">âœ¨ é¢„è§ˆ (é•¿æŒ‰ä¿å­˜çº¯å‡€ç…§ç‰‡)</p>
    <img id="result-img" src="">
    <button onclick="closePreview()" class="mt-6 bg-white text-black px-8 py-3 rounded-full font-bold">è¿”å›æ‹æ‘„</button>
</div>

<canvas id="canvas" style="display:none;"></canvas>

<script>
    const video = document.getElementById('video');
    const overlay = document.getElementById('pose-overlay');
    const resultContainer = document.getElementById('result-container');
    const resultImg = document.getElementById('result-img');
    const canvas = document.getElementById('canvas');

    // å§¿åŠ¿åº“ (Base64 æˆ– ç¨³å®šçš„ SVG)
    const poseLibrary = {
        street: [
            "data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAyNCAyNCIgZmlsbD0ibm9uZSIgc3Ryb2tlPSJ3aGl0ZSIgc3Ryb2tlLXdpZHRoPSIxIj48cGF0aCBkPSJNMTIgNWEyIDIgMCAxIDAgMC00IDIgMiAwIDAgMCAwIDR6TTEyIDV2OG0wIDBsLTMgNG0zLTQgMyA0bS0zLThoLTRtNCAwaDQiLz48L3N2Zz4=", // ç«™å§¿1
            "data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAyNCAyNCIgZmlsbD0ibm9uZSIgc3Ryb2tlPSJ3aGl0ZSIgc3Ryb2tlLXdpZHRoPSIxIj48cGF0aCBkPSJNMTIgN2EyIDIgMCAxIDAgMC00IDIgMiAwIDAgMCAwIDR6TTEwIDhoNHY3bC0yIDNoLTJsLTItM3oiLz48L3N2Zz4=" // ç«™å§¿2
        ],
        cafe: [
            "data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAyNCAyNCIgZmlsbD0ibm9uZSIgc3Ryb2tlPSJ3aGl0ZSIgc3Ryb2tlLXdpZHRoPSIxIj48cGF0aCBkPSJNOCA4aDh2NWgtOHpNOSAxN2g2djNoLTZ6TTUgNnYxNGgxNFY2SDV6Ii8+PC9zdmc+", // åå§¿1
        ],
        beach: ["data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAyNCAyNCIgZmlsbD0ibm9uZSIgc3Ryb2tlPSJ3aGl0ZSIgc3Ryb2tlLXdpZHRoPSIxIj48cGF0aCBkPSJNMTIgN2EyIDIgMCAxIDAgMC00IDIgMiAwIDAgMCAwIDR6TTEyIDE4bC00LTRtNC00djRtNCAwaC04bC00LTRtMTYgOGgtMTYiLz48L3N2Zz4="],
        park: ["data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAyNCAyNCIgZmlsbD0ibm9uZSIgc3Ryb2tlPSJ3aGl0ZSIgc3Ryb2tlLXdpZHRoPSIxIj48cGF0aCBkPSJNMTIgN2EyIDIgMCAxIDAgMC00IDIgMiAwIDAgMCAwIDR6TTEyIDE4bC00LTRtNC00djRtNCAwaC04bC00LTRtMTYgOGgtMTYiLz48L3N2Zz4="]
    };

    let currentScene = 'street';
    let poseIndex = 0;
    let useFacingMode = "environment"; // é»˜è®¤åç½®

    // å¯åŠ¨æ‘„åƒå¤´
    async function initCamera() {
        if (video.srcObject) {
            video.srcObject.getTracks().forEach(track => track.stop());
        }
        try {
            const stream = await navigator.mediaDevices.getUserMedia({ 
                video: { facingMode: useFacingMode }, 
                audio: false 
            });
            video.srcObject = stream;
        } catch (err) {
            alert("è¯·ç¡®ä¿ä½¿ç”¨ HTTPS å¹¶æˆäºˆæ‘„åƒå¤´æƒé™");
        }
    }

    // åˆ‡æ¢å‰åæ‘„åƒå¤´
    function toggleCamera() {
        useFacingMode = (useFacingMode === "environment") ? "user" : "environment";
        initCamera();
    }

    // åˆ‡æ¢åœºæ™¯
    function switchScene(scene, el) {
        currentScene = scene;
        poseIndex = 0;
        document.querySelectorAll('.scene-btn').forEach(btn => btn.classList.remove('active'));
        el.classList.add('active');
        updatePose();
    }

    // ä¸‹ä¸€ä¸ªå§¿åŠ¿
    function nextPose() {
        poseIndex = (poseIndex + 1) % poseLibrary[currentScene].length;
        updatePose();
    }

    function updatePose() {
        overlay.src = poseLibrary[currentScene][poseIndex];
    }

    // æ ¸å¿ƒï¼šæ‹ç…§ï¼ˆåªæ‹è§†é¢‘ï¼Œä¸æ‹è½®å»“çº¿ï¼‰
    function takePhoto() {
        canvas.width = video.videoWidth;
        canvas.height = video.videoHeight;
        const ctx = canvas.getContext('2d');
        
        // å¦‚æœæ˜¯å‰ç½®æ‘„åƒå¤´ï¼Œéœ€è¦æ°´å¹³ç¿»è½¬ç…§ç‰‡
        if (useFacingMode === "user") {
            ctx.translate(canvas.width, 0);
            ctx.scale(-1, 1);
        }
        
        ctx.drawImage(video, 0, 0, canvas.width, canvas.height);
        
        resultImg.src = canvas.toDataURL('image/jpeg', 0.9);
        resultContainer.style.display = 'flex';
    }

    function closePreview() {
        resultContainer.style.display = 'none';
    }

    window.onload = () => {
        initCamera();
        updatePose();
    };
</script>
</body>
</html>